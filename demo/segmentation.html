

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Semantic Segmentation &mdash; MinkowskiEngine 0.5.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3D Sparsity Pattern Reconstruction" href="sparse_tensor_reconstruction.html" />
    <link rel="prev" title="ModelNet40 Classification" href="modelnet40_classification.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> MinkowskiEngine
          

          
          </a>

          
            
            
              <div class="version">
                0.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Minkowski Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparse_tensor_network.html">Sparse Tensor Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Definitions and Terminology</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/sparse_tensor_basic.html">Sparse Tensor Basics</a></li>
</ul>
<p class="caption"><span class="caption-text">Demos</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="training.html">Training Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="modelnet40_classification.html">ModelNet40 Classification</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Semantic Segmentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#segmentation-of-a-hotel-room">Segmentation of a hotel room</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sparse_tensor_reconstruction.html">3D Sparsity Pattern Reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="interop.html">Working with Pytorch Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="multigpu.html">Multi-GPU with Pytorch-Lightning</a></li>
<li class="toctree-l1"><a class="reference internal" href="pointnet.html">PointNet</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sparse_tensor.html">SparseTensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../convolution.html">MinkowskiConvolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pooling.html">MinkowskiPooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../broadcast.html">MinkowskiBroadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../normalization.html">MinkowskiNormalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nonlinearity.html">MinkowskiNonlinearities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pruning.html">MinkowskiPruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../union.html">MinkowskiUnion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coords.html">Coordinate Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Utility Functions and Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common.html">Miscellaneous Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc.html">Miscellanea</a></li>
</ul>
<p class="caption"><span class="caption-text">Miscellanea</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Common Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides.html">Guidelines for Faster Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark.html">Benchmark</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MinkowskiEngine</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Semantic Segmentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/demo/segmentation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
            
  <div class="section" id="semantic-segmentation">
<h1>Semantic Segmentation<a class="headerlink" href="#semantic-segmentation" title="Permalink to this headline">¶</a></h1>
<p>To run the example, please install <a class="reference external" href="http://www.open3d.org/">Open3D</a> with <cite>pip
install open3d-python</cite>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /path/to/MinkowskiEngine
python -m examples.indoor
</pre></div>
</div>
<div class="section" id="segmentation-of-a-hotel-room">
<h2>Segmentation of a hotel room<a class="headerlink" href="#segmentation-of-a-hotel-room" title="Permalink to this headline">¶</a></h2>
<p>When you run the example, you will see a hotel room and semantic segmentation
of the room. You can interactively rotate the visualization when you run the
example. First, we load the data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pcd</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pcd</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">pcd</span>
</pre></div>
</div>
<p>You can provide a quantized coordinates that ensures there would be only one point per voxel, or you can use the new <code class="xref py py-attr docutils literal notranslate"><span class="pre">MinkowskiEngine.TensorField</span></code> that does not require quantized coordinates to process point clouds. However, since it does the quanization in the main training process instead of delegating the quantization to the data loading processes, it could slow down the training.
Next, you should create a batched coordinates by calling <a class="reference internal" href="../utils.html#MinkowskiEngine.utils.batched_coordinates" title="MinkowskiEngine.utils.batched_coordinates"><code class="xref py py-attr docutils literal notranslate"><span class="pre">MinkowskiEngine.utils.batched_coordinates</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a batch, this process is done in a data loader during training in parallel.</span>
<span class="n">in_field</span> <span class="o">=</span> <span class="n">ME</span><span class="o">.</span><span class="n">TensorField</span><span class="p">(</span>
    <span class="n">features</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span>
    <span class="n">coordinates</span><span class="o">=</span><span class="n">ME</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">batched_coordinates</span><span class="p">([</span><span class="n">coords</span> <span class="o">/</span> <span class="n">voxel_size</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">quantization_mode</span><span class="o">=</span><span class="n">ME</span><span class="o">.</span><span class="n">SparseTensorQuantizationMode</span><span class="o">.</span><span class="n">UNWEIGHTED_AVERAGE</span><span class="p">,</span>
    <span class="n">minkowski_algorithm</span><span class="o">=</span><span class="n">ME</span><span class="o">.</span><span class="n">MinkowskiAlgorithm</span><span class="o">.</span><span class="n">SPEED_OPTIMIZED</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Finally, we feed-forward the sparse tensor into the network and get the predictions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert to a sparse tensor</span>
<span class="n">sinput</span> <span class="o">=</span> <span class="n">in_field</span><span class="o">.</span><span class="n">sparse</span><span class="p">()</span>
<span class="c1"># Output sparse tensor</span>
<span class="n">soutput</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">sinput</span><span class="p">)</span>
<span class="c1"># get the prediction on the input tensor field</span>
<span class="n">out_field</span> <span class="o">=</span> <span class="n">soutput</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">in_field</span><span class="p">)</span>
</pre></div>
</div>
<p>After doing some post-processing. We can color the labels and visualize the
input and the prediction side-by-side.</p>
<img alt="../_images/segmentation.png" src="../_images/segmentation.png" />
<p>The weights are downloaded automatically once you run the example and the
weights are currently the top-ranking algorithm on the <a class="reference external" href="http://kaldir.vc.in.tum.de/scannet_benchmark/">Scannet 3D segmentation
benchmark</a>.</p>
<p>Please refer to the <a class="reference external" href="https://github.com/NVIDIA/MinkowskiEngine/blob/master/examples/indoor.py">complete indoor segmentation example</a>
for more detail.</p>
</div>
</div>


           </div>
           
          </div>
<a href="https://github.com/NVIDIA/MinkowskiEngine">
    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
</a>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-43980256-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-43980256-3');
</script>


          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="sparse_tensor_reconstruction.html" class="btn btn-neutral float-right" title="3D Sparsity Pattern Reconstruction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="modelnet40_classification.html" class="btn btn-neutral float-left" title="ModelNet40 Classification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Chris Choy.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>