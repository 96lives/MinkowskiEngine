

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>MinkowskiEngine.utils package &mdash; MinkowskiEngine 0.5.3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> MinkowskiEngine
          

          
          </a>

          
            
            
              <div class="version">
                0.5.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Minkowski Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparse_tensor_network.html">Sparse Tensor Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminology.html">Definitions and Terminology</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/sparse_tensor_basic.html">Sparse Tensor Basics</a></li>
</ul>
<p class="caption"><span class="caption-text">Demos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demo/training.html">Training Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo/modelnet40_classification.html">ModelNet40 Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo/segmentation.html">Semantic Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo/sparse_tensor_reconstruction.html">3D Sparsity Pattern Reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo/interop.html">Working with Pytorch Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo/multigpu.html">Multi-GPU with Pytorch-Lightning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo/pointnet.html">PointNet</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sparse_tensor.html">SparseTensor and TensorField</a></li>
<li class="toctree-l1"><a class="reference internal" href="../convolution.html">MinkowskiConvolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pooling.html">MinkowskiPooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../broadcast.html">MinkowskiBroadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../normalization.html">MinkowskiNormalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nonlinearity.html">MinkowskiNonlinearities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pruning.html">MinkowskiPruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interp.html">MinkowskiInterpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../union.html">MinkowskiUnion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coords.html">Coordinate Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Utility Functions and Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common.html">Miscellaneous Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc.html">Miscellanea</a></li>
</ul>
<p class="caption"><span class="caption-text">Miscellanea</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Common Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides.html">Guidelines for Faster Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_05.html">Migration Guide from v0.4.x to v0.5.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark.html">Benchmark</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MinkowskiEngine</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>MinkowskiEngine.utils package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/source/MinkowskiEngine.utils.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
            
  <div class="section" id="minkowskiengine-utils-package">
<h1>MinkowskiEngine.utils package<a class="headerlink" href="#minkowskiengine-utils-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-MinkowskiEngine.utils.collation">
<span id="minkowskiengine-utils-collation-module"></span><h2>MinkowskiEngine.utils.collation module<a class="headerlink" href="#module-MinkowskiEngine.utils.collation" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="MinkowskiEngine.utils.collation.SparseCollation">
<em class="property">class </em><code class="sig-prename descclassname">MinkowskiEngine.utils.collation.</code><code class="sig-name descname">SparseCollation</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">limit_numpoints</span><span class="o">=</span><span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">torch.int32</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.collation.SparseCollation" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Generates collate function for coords, feats, labels.</p>
<p>Please refer to <a class="reference external" href="https://nvidia.github.io/MinkowskiEngine/demo/training.html">the training example</a> for the
usage.</p>
<dl class="simple">
<dt>Args:</dt><dd><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">limit_numpoints</span></code> (int): If positive integer, limits batch size
so that the number of input coordinates is below limit_numpoints. If 0
or False, concatenate all points. -1 by default.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">dataset</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">collate_fn</span><span class="o">=</span><span class="n">SparseCollation</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="MinkowskiEngine.utils.collation.batch_sparse_collate">
<code class="sig-prename descclassname">MinkowskiEngine.utils.collation.</code><code class="sig-name descname">batch_sparse_collate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">torch.int32</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.collation.batch_sparse_collate" title="Permalink to this definition">¶</a></dt>
<dd><p>The wrapper function that can be used in in conjunction with
<cite>torch.utils.data.DataLoader</cite> to generate inputs for a sparse tensor.</p>
<p>Please refer to <a class="reference external" href="https://nvidia.github.io/MinkowskiEngine/demo/training.html">the training example</a> for the
usage.</p>
<dl class="simple">
<dt>Args:</dt><dd><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">data</span></code>: list of (coordinates, features, labels) tuples.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="MinkowskiEngine.utils.collation.batched_coordinates">
<code class="sig-prename descclassname">MinkowskiEngine.utils.collation.</code><code class="sig-name descname">batched_coordinates</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coords</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">torch.int32</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.collation.batched_coordinates" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a <cite>ME.SparseTensor</cite> coordinates from a sequence of coordinates</p>
<p>Given a list of either numpy or pytorch tensor coordinates, return the
batched coordinates suitable for <cite>ME.SparseTensor</cite>.</p>
<dl>
<dt>Args:</dt><dd><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords</span></code> (a sequence of <cite>torch.Tensor</cite> or <cite>numpy.ndarray</cite>): a
list of coordinates.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">dtype</span></code>: torch data type of the return tensor. torch.int32 by default.</p>
</dd>
<dt>Returns:</dt><dd><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">batched_coordindates</span></code> (<cite>torch.Tensor</cite>): a batched coordinates.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>From v0.4, the batch index will be prepended before all coordinates.</p>
</div>
</dd></dl>

<dl class="py function">
<dt id="MinkowskiEngine.utils.collation.sparse_collate">
<code class="sig-prename descclassname">MinkowskiEngine.utils.collation.</code><code class="sig-name descname">sparse_collate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coords</span></em>, <em class="sig-param"><span class="n">feats</span></em>, <em class="sig-param"><span class="n">labels</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">torch.int32</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.collation.sparse_collate" title="Permalink to this definition">¶</a></dt>
<dd><p>Create input arguments for a sparse tensor <a class="reference external" href="https://nvidia.github.io/MinkowskiEngine/sparse_tensor.html">the documentation</a>.</p>
<p>Convert a set of coordinates and features into the batch coordinates and
batch features.</p>
<dl>
<dt>Args:</dt><dd><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords</span></code> (set of <cite>torch.Tensor</cite> or <cite>numpy.ndarray</cite>): a set of coordinates.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">feats</span></code> (set of <cite>torch.Tensor</cite> or <cite>numpy.ndarray</cite>): a set of features.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">labels</span></code> (set of <cite>torch.Tensor</cite> or <cite>numpy.ndarray</cite>): a set of labels
associated to the inputs.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-MinkowskiEngine.utils.coords">
<span id="minkowskiengine-utils-coords-module"></span><h2>MinkowskiEngine.utils.coords module<a class="headerlink" href="#module-MinkowskiEngine.utils.coords" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="MinkowskiEngine.utils.coords.get_coords_map">
<code class="sig-prename descclassname">MinkowskiEngine.utils.coords.</code><code class="sig-name descname">get_coords_map</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">y</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.coords.get_coords_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Get mapping between sparse tensor 1 and sparse tensor 2.</p>
<dl>
<dt>Args:</dt><dd><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">x</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">MinkowskiEngine.SparseTensor</span></code>): a sparse tensor with
<cite>x.tensor_stride</cite> &lt;= <cite>y.tensor_stride</cite>.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">y</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">MinkowskiEngine.SparseTensor</span></code>): a sparse tensor with
<cite>x.tensor_stride</cite> &lt;= <cite>y.tensor_stride</cite>.</p>
</dd>
<dt>Returns:</dt><dd><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">x_indices</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">torch.LongTensor</span></code>): the indices of x that
corresponds to the returned indices of y.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">x_indices</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">torch.LongTensor</span></code>): the indices of y that
corresponds to the returned indices of x.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">python</span>

   <span class="n">sp_tensor</span> <span class="o">=</span> <span class="n">ME</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coordinates</span><span class="p">)</span>
   <span class="n">out_sp_tensor</span> <span class="o">=</span> <span class="n">stride_2_conv</span><span class="p">(</span><span class="n">sp_tensor</span><span class="p">)</span>

   <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span> <span class="o">=</span> <span class="n">get_coords_map</span><span class="p">(</span><span class="n">sp_tensor</span><span class="p">,</span> <span class="n">out_sp_tensor</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-MinkowskiEngine.utils.gradcheck">
<span id="minkowskiengine-utils-gradcheck-module"></span><h2>MinkowskiEngine.utils.gradcheck module<a class="headerlink" href="#module-MinkowskiEngine.utils.gradcheck" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="MinkowskiEngine.utils.gradcheck.gradcheck">
<code class="sig-prename descclassname">MinkowskiEngine.utils.gradcheck.</code><code class="sig-name descname">gradcheck</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span><span class="p">…</span><span class="p">]</span><span class="p">, </span>Union<span class="p">[</span>torch.Tensor<span class="p">, </span>Sequence<span class="p">[</span>torch.Tensor<span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">inputs</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>torch.Tensor<span class="p">, </span>Sequence<span class="p">[</span>torch.Tensor<span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">eps</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">1e-06</span></em>, <em class="sig-param"><span class="n">atol</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">1e-05</span></em>, <em class="sig-param"><span class="n">rtol</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.001</span></em>, <em class="sig-param"><span class="n">raise_exception</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">check_sparse_nnz</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em>, <em class="sig-param"><span class="n">nondet_tol</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">check_undefined_grad</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">check_grad_dtypes</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#MinkowskiEngine.utils.gradcheck.gradcheck" title="Permalink to this definition">¶</a></dt>
<dd><p>Check gradients computed via small finite differences against analytical
gradients w.r.t. tensors in <code class="xref py py-attr docutils literal notranslate"><span class="pre">inputs</span></code> that are of floating point or complex type
and with <code class="docutils literal notranslate"><span class="pre">requires_grad=True</span></code>.
The check between numerical and analytical gradients uses <code class="xref py py-func docutils literal notranslate"><span class="pre">allclose()</span></code>.
For complex functions, no notion of Jacobian exists. Gradcheck verifies if the numerical and
analytical values of Wirtinger and Conjugate Wirtinger derivative are consistent. The gradient
computation is done under the assumption that the overall function has a real valued output.
For functions with complex output, gradcheck compares the numerical and analytical gradients
for two values of <code class="xref py py-attr docutils literal notranslate"><span class="pre">grad_output</span></code>: 1 and 1j. For more details, check out
<span class="xref std std-ref">complex_autograd-doc</span>.
.. note:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The default values are designed for :attr:`input` of double precision.
This check will likely fail if :attr:`input` is of less precision, e.g.,
``FloatTensor``.
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If any checked tensor in <code class="xref py py-attr docutils literal notranslate"><span class="pre">input</span></code> has overlapping memory, i.e.,
different indices pointing to the same memory address (e.g., from
<code class="xref py py-func docutils literal notranslate"><span class="pre">torch.expand()</span></code>), this check will likely fail because the numerical
gradients computed by point perturbation at such indices will change
values at all other indices that share the same memory address.</p>
</div>
<dl>
<dt>Args:</dt><dd><dl class="simple">
<dt>func (function): a Python function that takes Tensor inputs and returns</dt><dd><p>a Tensor or a tuple of Tensors</p>
</dd>
</dl>
<p>inputs (tuple of Tensor or Tensor): inputs to the function
eps (float, optional): perturbation for finite differences
atol (float, optional): absolute tolerance
rtol (float, optional): relative tolerance
raise_exception (bool, optional): indicating whether to raise an exception if</p>
<blockquote>
<div><p>the check fails. The exception gives more information about the
exact nature of the failure. This is helpful when debugging gradchecks.</p>
</div></blockquote>
<dl class="simple">
<dt>check_sparse_nnz (bool, optional): if True, gradcheck allows for SparseTensor input,</dt><dd><p>and for any SparseTensor at input, gradcheck will perform check at nnz positions only.</p>
</dd>
<dt>nondet_tol (float, optional): tolerance for non-determinism. When running</dt><dd><p>identical inputs through the differentiation, the results must either match
exactly (default, 0.0) or be within this tolerance.</p>
</dd>
<dt>check_undefined_grad (bool, options): if True, check if undefined output grads</dt><dd><p>are supported and treated as zeros</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><p>True if all differences satisfy allclose condition</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-MinkowskiEngine.utils.init">
<span id="minkowskiengine-utils-init-module"></span><h2>MinkowskiEngine.utils.init module<a class="headerlink" href="#module-MinkowskiEngine.utils.init" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="MinkowskiEngine.utils.init.kaiming_normal_">
<code class="sig-prename descclassname">MinkowskiEngine.utils.init.</code><code class="sig-name descname">kaiming_normal_</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">a</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">'fan_in'</span></em>, <em class="sig-param"><span class="n">nonlinearity</span><span class="o">=</span><span class="default_value">'leaky_relu'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.init.kaiming_normal_" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-MinkowskiEngine.utils.quantization">
<span id="minkowskiengine-utils-quantization-module"></span><h2>MinkowskiEngine.utils.quantization module<a class="headerlink" href="#module-MinkowskiEngine.utils.quantization" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="MinkowskiEngine.utils.quantization.fnv_hash_vec">
<code class="sig-prename descclassname">MinkowskiEngine.utils.quantization.</code><code class="sig-name descname">fnv_hash_vec</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">arr</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.quantization.fnv_hash_vec" title="Permalink to this definition">¶</a></dt>
<dd><p>FNV64-1A</p>
</dd></dl>

<dl class="py function">
<dt id="MinkowskiEngine.utils.quantization.quantize">
<code class="sig-prename descclassname">MinkowskiEngine.utils.quantization.</code><code class="sig-name descname">quantize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coords</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.quantization.quantize" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a unique index map and an inverse index map.</p>
<dl>
<dt>Args:</dt><dd><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">torch.Tensor</span></code>): a
matrix of size <span class="math notranslate nohighlight">\(N \times D\)</span> where <span class="math notranslate nohighlight">\(N\)</span> is the number of
points in the <span class="math notranslate nohighlight">\(D\)</span> dimensional space.</p>
</dd>
<dt>Returns:</dt><dd><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">unique_map</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">torch.Tensor</span></code>): a
list of indices that defines unique coordinates.
<code class="xref py py-attr docutils literal notranslate"><span class="pre">coords[unique_map]</span></code> is the unique coordinates.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">inverse_map</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">torch.Tensor</span></code>): a
list of indices that defines the inverse map that recovers the original
coordinates.  <code class="xref py py-attr docutils literal notranslate"><span class="pre">coords[unique_map[inverse_map]]</span> <span class="pre">==</span> <span class="pre">coords</span></code></p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">unique_map</span><span class="p">,</span> <span class="n">inverse_map</span> <span class="o">=</span> <span class="n">quantize</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unique_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">unique_map</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">unique_coords</span><span class="p">[</span><span class="n">inverse_map</span><span class="p">]</span> <span class="o">==</span> <span class="n">coords</span><span class="p">)</span>  <span class="c1"># True, ..., True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">unique_map</span><span class="p">[</span><span class="n">inverse_map</span><span class="p">]]</span> <span class="o">==</span> <span class="n">coords</span><span class="p">)</span>  <span class="c1"># True, ..., True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="MinkowskiEngine.utils.quantization.quantize_label">
<code class="sig-prename descclassname">MinkowskiEngine.utils.quantization.</code><code class="sig-name descname">quantize_label</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coords</span></em>, <em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">ignore_label</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.quantization.quantize_label" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="MinkowskiEngine.utils.quantization.ravel_hash_vec">
<code class="sig-prename descclassname">MinkowskiEngine.utils.quantization.</code><code class="sig-name descname">ravel_hash_vec</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">arr</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.quantization.ravel_hash_vec" title="Permalink to this definition">¶</a></dt>
<dd><p>Ravel the coordinates after subtracting the min coordinates.</p>
</dd></dl>

<dl class="py function">
<dt id="MinkowskiEngine.utils.quantization.sparse_quantize">
<code class="sig-prename descclassname">MinkowskiEngine.utils.quantization.</code><code class="sig-name descname">sparse_quantize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coordinates</span></em>, <em class="sig-param"><span class="n">features</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">labels</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ignore_label</span><span class="o">=</span><span class="default_value">- 100</span></em>, <em class="sig-param"><span class="n">return_index</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">return_inverse</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">return_maps_only</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">quantization_size</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">'cpu'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#MinkowskiEngine.utils.quantization.sparse_quantize" title="Permalink to this definition">¶</a></dt>
<dd><p>Given coordinates, and features (optionally labels), the function
generates quantized (voxelized) coordinates.</p>
<dl>
<dt>Args:</dt><dd><blockquote>
<div><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coordinates</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">torch.Tensor</span></code>): a
matrix of size <span class="math notranslate nohighlight">\(N \times D\)</span> where <span class="math notranslate nohighlight">\(N\)</span> is the number of
points in the <span class="math notranslate nohighlight">\(D\)</span> dimensional space.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">features</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">torch.Tensor</span></code>, optional): a
matrix of size <span class="math notranslate nohighlight">\(N \times D_F\)</span> where <span class="math notranslate nohighlight">\(N\)</span> is the number of
points and <span class="math notranslate nohighlight">\(D_F\)</span> is the dimension of the features. Must have the
same container as <cite>coords</cite> (i.e. if <cite>coords</cite> is a torch.Tensor, <cite>feats</cite>
must also be a torch.Tensor).</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">labels</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">torch.IntTensor</span></code>,
optional): integer labels associated to eah coordinates.  Must have the
same container as <cite>coords</cite> (i.e. if <cite>coords</cite> is a torch.Tensor,
<cite>labels</cite> must also be a torch.Tensor). For classification where a set
of points are mapped to one label, do not feed the labels.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">ignore_label</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">int</span></code>, optional): the int value of the
IGNORE LABEL.
<code class="xref py py-attr docutils literal notranslate"><span class="pre">torch.nn.CrossEntropyLoss(ignore_index=ignore_label)</span></code></p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">return_index</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">bool</span></code>, optional): set True if you want the
indices of the quantized coordinates. False by default.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">return_inverse</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">bool</span></code>, optional): set True if you want
the indices that can recover the discretized original coordinates.
False by default. <cite>return_index</cite> must be True when <cite>return_reverse</cite> is True.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">return_maps_only</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">bool</span></code>, optional): if set, return the
unique_map or optionally inverse map, but not the coordinates. Can be
used if you don’t care about final coordinates or if you use
device==cuda and you don’t need coordinates on GPU. This returns either
unique_map alone or (unique_map, inverse_map) if return_inverse is set.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">quantization_size</span></code> (attr:<cite>float</cite>, optional): if set, will use
the quanziation size to define the smallest distance between
coordinates.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">device</span></code> (attr:<cite>str</cite>, optional): Either ‘cpu’ or ‘cuda’.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">unique_map</span><span class="p">,</span> <span class="n">inverse_map</span> <span class="o">=</span> <span class="n">sparse_quantize</span><span class="p">(</span><span class="n">discrete_coords</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unique_coords</span> <span class="o">=</span> <span class="n">discrete_coords</span><span class="p">[</span><span class="n">unique_map</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">unique_coords</span><span class="p">[</span><span class="n">inverse_map</span><span class="p">]</span> <span class="o">==</span> <span class="n">discrete_coords</span><span class="p">)</span>  <span class="c1"># True</span>
</pre></div>
</div>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">quantization_size</span></code> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-attr docutils literal notranslate"><span class="pre">list</span></code>, or
<code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>, optional): the length of the each side of the
hyperrectangle of of the grid cell.</p>
</div></blockquote>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Segmentation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coords</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">MinkowskiEngine</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">sparse_quantize</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">coords</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">ignore_label</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">quantization_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">MinkowskiEngine</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">coords</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">long</span><span class="p">())</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Classification</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coords</span><span class="p">,</span> <span class="n">feats</span> <span class="o">=</span> <span class="n">MinkowskiEngine</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">sparse_quantize</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">feats</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">MinkowskiEngine</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">coords</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">long</span><span class="p">())</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="MinkowskiEngine.utils.quantization.unique_coordinate_map">
<code class="sig-prename descclassname">MinkowskiEngine.utils.quantization.</code><code class="sig-name descname">unique_coordinate_map</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">coordinates</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">tensor_stride</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>int<span class="p">, </span>collections.abc.Sequence<span class="p">, </span>numpy.ndarray<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">1</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>torch.IntTensor<span class="p">, </span>torch.IntTensor<span class="p">]</span><a class="headerlink" href="#MinkowskiEngine.utils.quantization.unique_coordinate_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the unique indices and the inverse indices of the coordinates.</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coordinates</span></code>: <cite>torch.Tensor</cite> (Int tensor. <cite>CUDA</cite> if
coordinate_map_type == <cite>CoordinateMapType.GPU</cite>) that defines the
coordinates.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">IntTensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unique_map</span><span class="p">,</span> <span class="n">inverse_map</span> <span class="o">=</span> <span class="n">unique_coordinates_map</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coordinates</span><span class="p">[</span><span class="n">unique_map</span><span class="p">]</span> <span class="c1"># unique coordinates</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">torch</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">coordinates</span> <span class="o">==</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">unique_map</span><span class="p">][</span><span class="n">inverse_map</span><span class="p">])</span> <span class="c1"># True</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-MinkowskiEngine.utils">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-MinkowskiEngine.utils" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
<a href="https://github.com/NVIDIA/MinkowskiEngine">
    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
</a>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-43980256-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-43980256-3');
</script>


          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Chris Choy.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>